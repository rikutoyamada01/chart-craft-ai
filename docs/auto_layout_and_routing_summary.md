# 自動回路図生成のためのアルゴリズム選定と実装アプローチ

## 1. 目的

本ドキュメントは、YAML形式で定義された回路情報を基に、自動で回路図を描画・生成するための技術的なアプローチをまとめたものです。

## 2. 推奨アルゴリズム

回路図の自動生成は、「レイアウト（部品の配置）」と「配線（部品間の接続）」の2つのフェーズに大別されます。それぞれに最適なアルゴリズムは以下の通りです。

### 2.1. レイアウト：階層型（Sugiyama）アルゴリズム

- **仕組み：** 回路の信号の流れのような有向グラフを、複数の水平な「階層」に分割して描画します。部品（ノード）を各階層に配置し、配線（エッジ）の交差が最小になるように順序を調整することで、信号の流れが可視化され、見通しの良いレイアウトを実現します。
- **選定理由：** 信号の流れを視覚的に理解しやすくするのに非常に適しています。グラフ描画ツールキット**Graphviz**の`dot`エンジンで採用されている、実績のある業界標準の手法です。

### 2.2. 配線：迷路法（Leeアルゴリズム） / A*探索アルゴリズム

- **仕組み：** グリッド（格子）状の盤面上で、スタート地点からゴール地点までの最短経路を探索します。迷路法は幅優先探索（BFS）により網羅的に探索し、A*探索はゴールまでの推定距離を考慮して効率的に探索します。
- **選定理由：** 配線経路が存在すれば必ず最短経路を発見できる確実性があります。部品間の接続を物理的な線として描画する際の基本的なアプローチです。

## 3. 実装アプローチとツールキット

### 3.1. 推奨ワークフロー

以下のステップで実装を進めることを推奨します。

1.  **入力 (YAML)：** 人間が読み書きしやすいYAML形式で回路情報（部品、接続リスト）を定義します。
2.  **パーサー (Python)：** `PyYAML`などのライブラリを使い、YAMLファイルを読み込みます。
3.  **グラフ構築 (NetworkX)：** 読み込んだ情報を基に、Pythonの`NetworkX`ライブラリを使ってプログラム内でグラフデータ構造を構築します。
4.  **レイアウト計算 (Graphviz)：** `NetworkX`から`Graphviz`を呼び出し、階層型アルゴリズムを適用して各部品の配置座標を決定します。
5.  **配線計算 (自作)：** 決定した座標を基に、自前で実装した迷路法/A*アルゴリズムで、部品ピン間の具体的な配線経路を計算します。
6.  **描画・出力：** `matplotlib`や`svgwrite`などのライブラリを使い、最終的な回路図をSVGやPNGなどの形式で出力します。

### 3.2. 主要ツール

- **Graphviz:**
    - **役割：** 自動レイアウト計算。
    - **入力形式：** 独自の`DOT`言語。 `digraph G { A -> B; }` のようにノードと接続を記述します。
- **NetworkX:**
    - **役割：** Pythonプログラム内でのグラフデータの操作と、Graphvizの呼び出し。

## 4. 【補足】回路設計における配線アルゴリズムの高度化

- **基本原理は公開されている：** 迷路法のアルゴリズム自体は、コンピュータサイエンスの基本的なものであり、広く知られています。

- **「ルールと比重」は非公開のノウハウ：** 実際の商用EDAツール（KiCad, Altiumなど）では、単に最短経路を探すだけでなく、以下のような多様な制約を考慮した高度なコスト計算が行われます。この「ルールと比重」の具体的な内容は、各社の競争力の源泉であるため、**通常は公開されません。**
    - **ビアのコスト：** 多層基板で層をまたぐ際のペナルティ。
    - **屈曲のコスト：** 配線が曲がる回数に対するペナルティ。
    - **配線方向の優先：** 基板の層ごとに推奨される配線方向（水平/垂直）。
    - **クリアランス：** 他の配線や部品との安全な距離の確保。

したがって、高性能な自動配線ツールを実装するには、基本の迷路法アルゴリズムに、これらのドメイン知識に基づいた独自のコスト関数を設計・調整していく必要があります。
